def prompt(phrase):
    filename = input(phrase)
    if len(filename) < 1:
        return ""
    return open(filename)

def splitHex(char):
    toHex = ord(char)
    upperHalf = toHex >> 4
    lowerHalf = toHex & 3
    return upperHalf, lowerHalf

def findHexBits(plainChar, keyChar):
    ## A function that given to 4 bit numbers finds a hex value
    ph, pl = splitHex(plainChar)
    kh, kl = splitHex(keyChar)
    hexMap = [
        [0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe], 
        [0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0], 
        [0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7], 
        [0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa],  
        [0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4],      
        [0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3],     
        [0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1], 
        [0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf], 
        [0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2],                             
        [0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5],                             
        [0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb],                             
        [0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6],                              
        [0x9, 0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8],                              
        [0xd, 0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9],                              
        [0xc, 0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd],                              
        [0xe, 0xf, 0x7, 0x6, 0x4, 0x5, 0x1, 0x0, 0x2, 0x3, 0xb, 0xa, 0x8, 0x9, 0xd, 0xc] 
    ]
    # print hex(hexMap[ph][kl] << 4)
    # print hex(hexMap[pl][kh])
    # print type(hex((hexMap[ph][kl] << 4) + hexMap[pl][kh]))
    return (hexMap[ph][kl] << 4) + hexMap[pl][kh]

def vigEncryptText(plaintext, key):
    encrypted = []
    keyLen = len(key)
    for index,char in enumerate(plaintext):
        if ord(char) > 31 and ord(char) < 127:
            encrypted.append(findHexBits(char, key[index%keyLen]))

    return encrypted
    
if __name__ == "__main__":

    keyPhrase = "What is the name of the key file? (please note, only the first line will be read for the key) "
    keyFile = prompt(keyPhrase)

    plaintextPhrase = "What is the name of the file you would like to encrypt? "
    plaintextFile = prompt(plaintextPhrase)

    if type(keyFile) == str and type(plaintextFile) == str and (len(keyFile) < 1 or len(plaintextFile) < 1):
        print("\nKey file or plaintext file does not exist\n")
    else:
        mainList = ""
        key = keyFile.readlines()[0]
        for line in plaintextFile:
            mainList = mainList + line.strip()
        
        encryptedText = vigEncryptText(mainList, key)
        encrypted = open("encrypted.txt", "wb")
        encrypted.write(bytes(encryptedText))
